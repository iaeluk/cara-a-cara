import React, { useState, useEffect, useCallback, useRef, useMemo } from 'react';
import { Trophy, Play, X, Check, Settings, Volume2, VolumeX, Trash2, RotateCcw, LogOut, ChevronDown, ChevronUp } from 'lucide-react';

// --- CONFIGURAÇÃO DE DADOS MASSIVA ---
// Usamos listas simples para facilitar a manutenção de milhares de itens
const RAW_DATA = {
  "Comida": [
    "Arroz", "Feijão", "Feijoada", "Pizza", "Hambúrguer", "Batata Frita", "Sushi", "Sashimi", "Temaki", "Yakisoba",
    "Churrasco", "Picanha", "Linguiça", "Farofa", "Vinagrete", "Salpicão", "Maionese", "Lasanha", "Nhoque", "Ravioli",
    "Macarrão", "Espaguete", "Panqueca", "Omelete", "Ovo Frito", "Misto Quente", "Bauru", "Hot Dog", "Pastel", "Coxinha",
    "Kibe", "Esfiha", "Empada", "Pão de Queijo", "Croquete", "Risoles", "Acarajé", "Vatapá", "Moqueca", "Bobó de Camarão",
    "Baião de Dois", "Carne de Sol", "Tapioca", "Cuscuz", "Pamonha", "Canjica", "Pipoca", "Bolo de Cenoura", "Bolo de Chocolate",
    "Brigadeiro", "Beijinho", "Pudim", "Mousse", "Gelatina", "Açaí", "Sorvete", "Picolé", "Paçoca", "Pé de Moleque", "Churros",
    "Sonho", "Donut", "Waffle", "Crepe", "Fondue", "Petit Gateau", "Brownie", "Cookie", "Torta de Limão", "Cheesecake", "Tiramisu",
    "Café", "Leite", "Suco de Laranja", "Refrigerante", "Água de Coco", "Caldo de Cana", "Cerveja", "Vinho", "Caipirinha",
    "Banana", "Maçã", "Laranja", "Limão", "Uva", "Melancia", "Melão", "Abacaxi", "Morango", "Pera", "Manga", "Mamão", "Abacate",
    "Coco", "Maracujá", "Kiwi", "Cereja", "Pêssego", "Ameixa", "Goiaba", "Caju", "Jabuticaba", "Caqui", "Figo", "Amora", "Framboesa",
    "Tomate", "Batata", "Cenoura", "Alface", "Cebola", "Alho", "Brócolis", "Couve", "Espinafre", "Pepino", "Abóbora", "Chuchu",
    "Beterraba", "Pimentão", "Milho", "Ervilha", "Palmito", "Azeitona", "Cogumelo", "Bacon", "Presunto", "Queijo", "Requeijão",
    "Iogurte", "Manteiga", "Mel", "Açúcar", "Sal", "Pimenta", "Azeite", "Vinagre", "Ketchup", "Mostarda", "Ovo de Páscoa", "Panetone",
    "Rabanada", "Peru de Natal", "Chester", "Lentilha", "Bacalhau", "Salmão", "Atum", "Sardinha", "Camarão", "Lagosta", "Lula", "Polvo"
  ],
  "Animais": [
    "Cachorro", "Gato", "Hamster", "Coelho", "Cavalo", "Vaca", "Boi", "Porco", "Ovelha", "Cabra", "Galinha", "Galo", "Pato", "Peru",
    "Leão", "Tigre", "Onça", "Leopardo", "Lobo", "Raposa", "Urso", "Urso Polar", "Panda", "Elefante", "Girafa", "Hipopótamo",
    "Rinoceronte", "Zebra", "Búfalo", "Canguru", "Coala", "Macaco", "Gorila", "Chimpanzé", "Mico", "Preguiça", "Tamanduá", "Tatu",
    "Capivara", "Anta", "Esquilo", "Castor", "Lontra", "Foca", "Leão Marinho", "Baleia", "Golfinho", "Orca", "Tubarão", "Peixe",
    "Salmão", "Tartaruga", "Jabuti", "Jacaré", "Crocodilo", "Cobra", "Sapo", "Rã", "Águia", "Gavião", "Coruja", "Urubu", "Papagaio",
    "Arara", "Tucano", "Pinguim", "Avestruz", "Pombo", "Beija-Flor", "Morcego", "Abelha", "Formiga", "Borboleta", "Mosca", "Mosquito",
    "Aranha", "Escorpião", "Barata", "Besouro", "Grilo", "Gafanhoto", "Minhoca", "Caracol", "Estrela do Mar", "Água Viva", "Polvo",
    "Lula", "Camarão", "Caranguejo", "Siri", "Lagosta", "Dinossauro", "T-Rex", "Mamute", "Unicórnio", "Dragão", "Fênix", "Pégaso",
    "Lobisomem", "Pônei", "Lhama", "Alpaca", "Camelo", "Dromedário", "Hiena", "Suricato", "Lêmure", "Ornitorrinco", "Equidna"
  ],
  "Objetos": [
    "Celular", "Computador", "Notebook", "Tablet", "Televisão", "Controle Remoto", "Videogame", "Fone de Ouvido", "Carregador",
    "Câmera", "Relógio", "Smartwatch", "Impressora", "Roteador", "Pen Drive", "Teclado", "Mouse", "Caixa de Som", "Microfone",
    "Geladeira", "Fogão", "Micro-ondas", "Forno", "Liquidificador", "Batedeira", "Torradeira", "Cafeteira", "Air Fryer",
    "Máquina de Lavar", "Ferro de Passar", "Aspirador de Pó", "Ventilador", "Ar Condicionado", "Lâmpada", "Abajur", "Lanterna",
    "Cama", "Colchão", "Travesseiro", "Cobertor", "Lençol", "Sofá", "Poltrona", "Cadeira", "Mesa", "Guarda-Roupa", "Armário",
    "Gaveta", "Espelho", "Tapete", "Cortina", "Vaso", "Quadro", "Porta", "Janela", "Chave", "Cadeado", "Vassoura", "Rodo",
    "Balde", "Pano", "Esponja", "Sabão", "Detergente", "Shampoo", "Sabonete", "Escova de Dente", "Pasta de Dente", "Fio Dental",
    "Pente", "Escova de Cabelo", "Secador", "Chapinha", "Barbeador", "Cortador de Unha", "Alicate", "Esmalte", "Batom", "Perfume",
    "Desodorante", "Papel Higiênico", "Toalha", "Prato", "Copo", "Xícara", "Caneca", "Taça", "Garfo", "Faca", "Colher", "Concha",
    "Panela", "Frigideira", "Forma", "Tigela", "Pote", "Garrafa", "Saca-Rolhas", "Abridor", "Tesoura", "Estilete", "Régua",
    "Caneta", "Lápis", "Borracha", "Apontador", "Caderno", "Livro", "Agenda", "Pasta", "Grampeador", "Clips", "Fita Adesiva",
    "Cola", "Mochila", "Bolsa", "Carteira", "Mala", "Guarda-Chuva", "Óculos", "Óculos de Sol", "Anel", "Brinco", "Colar", "Pulseira"
  ],
  "Famosos": [
    "Silvio Santos", "Faustão", "Gugu", "Xuxa", "Ana Maria Braga", "Luciano Huck", "Eliana", "Celso Portiolli", "Ratinho", "Datena",
    "William Bonner", "Fátima Bernardes", "Pedro Bial", "Tiago Leifert", "Tadeu Schmidt", "Marcos Mion", "Sabrina Sato", "Ivete Sangalo",
    "Claudia Leitte", "Anitta", "Ludmilla", "Iza", "Luísa Sonza", "Gloria Groove", "Pabllo Vittar", "Marília Mendonça", "Gusttavo Lima",
    "Luan Santana", "Jorge e Mateus", "Henrique e Juliano", "Zé Neto e Cristiano", "Maiara e Maraisa", "Simone e Simaria", "Roberto Carlos",
    "Caetano Veloso", "Gilberto Gil", "Chico Buarque", "Djavan", "Tim Maia", "Cazuza", "Renato Russo", "Rita Lee", "Elis Regina",
    "Neymar", "Pelé", "Ronaldo Fenômeno", "Ronaldinho Gaúcho", "Romário", "Zico", "Kaká", "Cafu", "Roberto Carlos (Jogador)",
    "Messi", "Cristiano Ronaldo", "Mbappé", "Maradona", "Beckham", "Marta", "Formiga", "Gisele Bündchen", "Alessandra Ambrósio",
    "Adriana Lima", "Juliette", "Gil do Vigor", "Boca Rosa", "Virgínia", "Zé Felipe", "Whindersson Nunes", "Felipe Neto",
    "Casimiro", "Alanzoka", "Gaules", "Luva de Pedreiro", "Maísa", "Larissa Manoela", "Bruna Marquezine", "Marina Ruy Barbosa",
    "Paolla Oliveira", "Juliana Paes", "Grazi Massafera", "Tatá Werneck", "Paulo Gustavo", "Fábio Porchat", "Danilo Gentili",
    "Michael Jackson", "Madonna", "Beyoncé", "Rihanna", "Lady Gaga", "Katy Perry", "Taylor Swift", "Ariana Grande", "Adele",
    "Shakira", "Jennifer Lopez", "Britney Spears", "Justin Bieber", "Bruno Mars", "Ed Sheeran", "The Weeknd", "Drake", "Eminem",
    "Snoop Dogg", "Kanye West", "Jay-Z", "Elvis Presley", "Freddie Mercury", "John Lennon", "Paul McCartney", "David Bowie",
    "Kurt Cobain", "Axl Rose", "Mick Jagger", "Elton John", "Brad Pitt", "Angelina Jolie", "Leonardo DiCaprio", "Tom Cruise",
    "Will Smith", "Johnny Depp", "Robert Downey Jr", "Chris Evans", "Chris Hemsworth", "Scarlett Johansson", "Jennifer Aniston",
    "Julia Roberts", "Meryl Streep", "Sandra Bullock", "Dwayne Johnson (The Rock)", "Vin Diesel", "Keanu Reeves", "Nicolas Cage"
  ],
  "Personagens": [
    "Mickey Mouse", "Minnie", "Pato Donald", "Pateta", "Pluto", "Cinderela", "Branca de Neve", "Ariel", "Bela", "Jasmine",
    "Elsa", "Anna", "Olaf", "Moana", "Mulan", "Pocahontas", "Tiana", "Rapunzel", "Merida", "Sininho", "Peter Pan", "Capitão Gancho",
    "Simba", "Timão", "Pumba", "Mufasa", "Scar", "Woody", "Buzz Lightyear", "Jessie", "Sr. Cabeça de Batata", "Relâmpago McQueen",
    "Mate", "Nemo", "Dory", "Shrek", "Fiona", "Burro", "Gato de Botas", "Gru", "Minions", "Bob Esponja", "Patrick", "Lula Molusco",
    "Seu Sirigueijo", "Sandy Bochechas", "Plankton", "Goku", "Vegeta", "Gohan", "Piccolo", "Freeza", "Cell", "Majin Boo", "Naruto",
    "Sasuke", "Sakura", "Kakashi", "Luffy", "Zoro", "Sanji", "Nami", "Chopper", "Pikachu", "Ash Ketchum", "Charizard", "Bulbasaur",
    "Squirtle", "Meowth", "Jigglypuff", "Snorlax", "Mewtwo", "Yugi Muto", "Kaiba", "Seiya", "Shiryu", "Hyoga", "Shun", "Ikki",
    "Saori", "Sailor Moon", "Sakura Card Captors", "Harry Potter", "Hermione", "Rony Weasley", "Dumbledore", "Snape", "Voldemort",
    "Dobby", "Hagrid", "Frodo", "Gandalf", "Aragorn", "Legolas", "Gimli", "Gollum", "Sauron", "Luke Skywalker", "Darth Vader",
    "Princesa Leia", "Han Solo", "Chewbacca", "Yoda", "Obi-Wan Kenobi", "Kylo Ren", "Rey", "Mandaloriano", "Baby Yoda",
    "Homem de Ferro", "Capitão América", "Thor", "Hulk", "Viúva Negra", "Gavião Arqueiro", "Homem-Aranha", "Doutor Estranho",
    "Pantera Negra", "Capitã Marvel", "Thanos", "Loki", "Wolverine", "Deadpool", "Professor Xavier", "Magneto", "Tempestade",
    "Batman", "Superman", "Mulher Maravilha", "Flash", "Aquaman", "Ciborgue", "Lanterna Verde", "Coringa", "Arlequina",
    "Charada", "Pinguim", "Mulher Gato", "Lex Luthor", "Mario", "Luigi", "Princesa Peach", "Bowser", "Yoshi", "Toad", "Sonic",
    "Tails", "Knuckles", "Eggman", "Link", "Zelda", "Kratos", "Master Chief", "Lara Croft", "Pac-Man", "Ryu", "Ken", "Chun-Li",
    "Scorpion", "Sub-Zero", "Chaves", "Kiko", "Chiquinha", "Seu Madruga", "Dona Florinda", "Professor Girafales", "Bruxa do 71",
    "Sr. Barriga", "Nhonho", "Chapolin Colorado", "Mônica", "Cebolinha", "Cascão", "Magali", "Chico Bento", "Franjinha", "Bidu"
  ],
  "Filmes & Séries": [
    "Vingadores", "Liga da Justiça", "Star Wars", "Harry Potter", "Senhor dos Anéis", "O Hobbit", "Piratas do Caribe", "Velozes e Furiosos",
    "Missão Impossível", "007", "Matrix", "Exterminador do Futuro", "De Volta para o Futuro", "Indiana Jones", "Jurassic Park",
    "Tubarão", "O Poderoso Chefão", "Pulp Fiction", "Clube da Luta", "Forrest Gump", "Titanic", "Avatar", "O Rei Leão", "Toy Story",
    "Shrek", "Meu Malvado Favorito", "Frozen", "Divertida Mente", "Procurando Nemo", "Os Incríveis", "Carros", "Monstros S.A.",
    "Up: Altas Aventuras", "Wall-E", "Ratatouille", "A Era do Gelo", "Madagascar", "Kung Fu Panda", "Como Treinar o Seu Dragão",
    "Minions", "Homem-Aranha", "Batman", "Superman", "X-Men", "Friends", "How I Met Your Mother", "The Big Bang Theory", "Two and a Half Men",
    "Um Maluco no Pedaço", "Todo Mundo Odeia o Chris", "Eu, a Patroa e as Crianças", "Chaves", "Chapolin", "A Grande Família",
    "Tapas e Beijos", "Sai de Baixo", "Os Normais", "Vai que Cola", "Game of Thrones", "Breaking Bad", "Stranger Things", "The Walking Dead",
    "Grey's Anatomy", "House", "Supernatural", "Lost", "Prison Break", "La Casa de Papel", "Round 6", "Dark", "Black Mirror", "The Crown",
    "Bridgerton", "Wandinha", "The Witcher", "The Last of Us", "O Gambito da Rainha", "Peaky Blinders", "Vikings", "Suits", "Lucifer",
    "Brooklyn Nine-Nine", "The Office", "Modern Family", "Simpsons", "Uma Família da Pesada", "South Park", "Rick and Morty", "Futurama"
  ],
  "Profissões": [
    "Médico", "Enfermeiro", "Dentista", "Veterinário", "Psicólogo", "Fisioterapeuta", "Nutricionista", "Farmacêutico", "Biomédico",
    "Professor", "Pedagogo", "Diretor de Escola", "Advogado", "Juiz", "Promotor", "Delegado", "Policial", "Bombeiro", "Guarda de Trânsito",
    "Segurança", "Detetive", "Engenheiro Civil", "Engenheiro Elétrico", "Engenheiro Mecânico", "Arquiteto", "Designer de Interiores",
    "Pedreiro", "Pintor", "Eletricista", "Encanador", "Marceneiro", "Serralheiro", "Mecânico", "Borracheiro", "Motorista", "Taxista",
    "Caminhoneiro", "Motoboy", "Piloto de Avião", "Comissário de Bordo", "Astronauta", "Marinheiro", "Pescador", "Agricultor", "Fazendeiro",
    "Jardineiro", "Gari", "Lixeiro", "Empregada Doméstica", "Babá", "Cozinheiro", "Chef de Cozinha", "Garçom", "Barman", "Padeiro",
    "Confeiteiro", "Açougueiro", "Feirante", "Vendedor", "Caixa de Supermercado", "Atendente", "Recepcionista", "Secretária",
    "Telefonista", "Cabeleireiro", "Barbeiro", "Manicure", "Maquiador", "Esteticista", "Massagista", "Tatuador", "Costureira",
    "Estilista", "Modelo", "Fotógrafo", "Jornalista", "Repórter", "Apresentador", "Locutor", "Ator", "Cantor", "Músico", "DJ",
    "Dançarino", "Palhaço", "Mágico", "Malabarista", "Escritor", "Poeta", "Pintor (Artista)", "Escultor", "Programador", "Web Designer",
    "Analista de Sistemas", "Cientista", "Biólogo", "Químico", "Físico", "Astrônomo", "Historiador", "Geógrafo", "Matemático",
    "Economista", "Contador", "Administrador", "Empresário", "Corretor de Imóveis", "Bancário", "Político", "Padre", "Pastor"
  ],
  "Lugares": [
    "Brasil", "Estados Unidos", "Argentina", "Portugal", "Espanha", "França", "Itália", "Alemanha", "Inglaterra", "Japão", "China",
    "Coreia do Sul", "Índia", "Rússia", "Austrália", "Canadá", "México", "Egito", "África do Sul", "Grécia", "Turquia", "Israel",
    "Arábia Saudita", "Dubai", "Paris", "Londres", "Nova York", "Los Angeles", "Las Vegas", "Miami", "Orlando", "Disney", "Roma",
    "Veneza", "Tóquio", "Pequim", "Sydney", "Rio de Janeiro", "São Paulo", "Salvador", "Recife", "Fortaleza", "Brasília",
    "Belo Horizonte", "Curitiba", "Porto Alegre", "Florianópolis", "Manaus", "Belém", "Fernando de Noronha", "Cristo Redentor",
    "Pão de Açúcar", "Maracanã", "Copacabana", "Ipanema", "Avenida Paulista", "Parque Ibirapuera", "Cataratas do Iguaçu", "Amazônia",
    "Pantanal", "Lençóis Maranhenses", "Pelourinho", "Torre Eiffel", "Estátua da Liberdade", "Coliseu", "Torre de Pisa",
    "Muralha da China", "Pirâmides do Egito", "Taj Mahal", "Machu Picchu", "Grand Canyon", "Monte Everest", "Antártida", "Lua", "Marte",
    "Casa", "Escola", "Faculdade", "Trabalho", "Escritório", "Hospital", "Farmácia", "Supermercado", "Padaria", "Açougue", "Feira",
    "Shopping", "Loja", "Banco", "Correio", "Delegacia", "Igreja", "Cemitério", "Cinema", "Teatro", "Museu", "Biblioteca", "Estádio",
    "Ginásio", "Academia", "Parque", "Praça", "Praia", "Piscina", "Clube", "Zoológico", "Circo", "Parque de Diversões", "Restaurante",
    "Lanchonete", "Bar", "Balada", "Hotel", "Aeroporto", "Rodoviária", "Estação de Trem", "Metrô", "Ponto de Ônibus", "Posto de Gasolina"
  ],
  "Corpo Humano": [
    "Cabeça", "Cabelo", "Testa", "Sobrancelha", "Olho", "Cílios", "Orelha", "Nariz", "Bochecha", "Boca", "Lábio", "Dente", "Língua",
    "Queixo", "Barba", "Bigode", "Pescoço", "Garganta", "Ombro", "Braço", "Cotovelo", "Antebraço", "Pulso", "Mão", "Dedo", "Unha",
    "Polegar", "Peito", "Seio", "Mamilo", "Barriga", "Umbigo", "Costas", "Coluna", "Cintura", "Quadril", "Bumbum", "Perna", "Coxa",
    "Joelho", "Canela", "Panturrilha", "Tornozelo", "Calcanhar", "Pé", "Dedo do Pé", "Pele", "Osso", "Músculo", "Sangue", "Veia",
    "Artéria", "Coração", "Pulmão", "Estômago", "Fígado", "Rim", "Intestino", "Bexiga", "Cérebro", "Crânio", "Costela", "Esqueleto"
  ],
  "Natureza & Espaço": [
    "Sol", "Lua", "Estrela", "Planeta", "Terra", "Marte", "Júpiter", "Saturno", "Galáxia", "Universo", "Buraco Negro", "Cometa",
    "Meteoro", "Asteroide", "Foguete", "Astronauta", "Alien", "Ovni", "Céu", "Nuvem", "Chuva", "Raio", "Trovão", "Tempestade",
    "Neve", "Granizo", "Vento", "Furacão", "Tornado", "Terremoto", "Tsunami", "Vulcão", "Arco-Íris", "Aurora Boreal", "Nascer do Sol",
    "Pôr do Sol", "Dia", "Noite", "Eclipse", "Mar", "Oceano", "Onda", "Praia", "Areia", "Ilha", "Rio", "Lago", "Lagoa", "Cachoeira",
    "Montanha", "Morro", "Vale", "Deserto", "Floresta", "Selva", "Árvore", "Flor", "Rosa", "Girassol", "Margarida", "Orquídea",
    "Cacto", "Grama", "Folha", "Pedra", "Rocha", "Terra", "Lama", "Fogo", "Fumaça", "Cinza", "Gelo", "Água", "Ar"
  ],
  "Veículos": [
    "Carro", "Moto", "Caminhão", "Ônibus", "Bicicleta", "Skate", "Patins", "Patinete", "Avião", "Helicóptero", "Barco", "Navio",
    "Lancha", "Submarino", "Trem", "Metrô", "Bonde", "Táxi", "Uber", "Ambulância", "Viatura de Polícia", "Carro de Bombeiro",
    "Trator", "Escavadeira", "Guindaste", "Empilhadeira", "Foguete", "Disco Voador", "Balão", "Dirigível", "Paraquedas", "Asa Delta",
    "Jet Ski", "Canoa", "Jangada", "Veleiro", "Cruzeiro", "Fusca", "Brasília", "Kombi", "Ferrari", "Lamborghini", "Porsche", "Camaro",
    "Mustang", "Jeep", "Picape", "Van", "Limusine", "Carruagem", "Charrete", "Triciclo", "Quadriciclo", "Carrinho de Mão", "Carrinho de Bebê"
  ],
  "Marcas & Apps": [
    "Coca-Cola", "Pepsi", "McDonald's", "Burger King", "Subway", "Starbucks", "Nestlé", "Garoto", "Lacta", "Kinder", "Nutella",
    "Oreo", "Doritos", "Ruffles", "Cheetos", "Pringles", "M&M's", "Snickers", "KitKat", "Havaianas", "Nike", "Adidas", "Puma",
    "Vans", "Converse", "Gucci", "Louis Vuitton", "Chanel", "Zara", "Renner", "Riachuelo", "C&A", "Apple", "iPhone", "Samsung",
    "Xiaomi", "Motorola", "Nokia", "Sony", "LG", "Microsoft", "Windows", "Google", "Facebook", "Instagram", "WhatsApp", "TikTok",
    "Twitter", "X", "YouTube", "Netflix", "Amazon", "Prime Video", "Disney+", "HBO Max", "Spotify", "Uber", "iFood", "Rappi",
    "Mercado Livre", "Shopee", "AliExpress", "Shein", "Nubank", "Inter", "Itaú", "Bradesco", "Caixa", "Banco do Brasil", "Santander",
    "Ferrari", "Lamborghini", "Porsche", "BMW", "Mercedes", "Audi", "Volkswagen", "Ford", "Chevrolet", "Fiat", "Toyota", "Honda",
    "Hyundai", "Jeep", "Tesla", "PlayStation", "Xbox", "Nintendo", "Lego", "Barbie", "Hot Wheels", "Monopoly", "Uno", "Globo", "SBT"
  ],
  "História & Mitos": [
    "Jesus", "Deus", "Diabo", "Anjo", "Demônio", "Papai Noel", "Coelhinho da Páscoa", "Fada do Dente", "Saci Pererê", "Curupira",
    "Mula Sem Cabeça", "Boto Cor-de-Rosa", "Iara", "Boitatá", "Cuca", "Lobisomem", "Vampiro", "Drácula", "Frankenstein", "Múmia",
    "Zumbi", "Fantasma", "Bruxa", "Fada", "Sereia", "Duende", "Gnomo", "Ogro", "Gigante", "Ciclope", "Minotauro", "Medusa", "Pégaso",
    "Unicórnio", "Dragão", "Fênix", "Kraken", "Pé Grande", "Monstro do Lago Ness", "ET", "Alien", "Zeus", "Poseidon", "Hades", "Apolo",
    "Ares", "Afrodite", "Atena", "Hércules", "Thor", "Odin", "Loki", "Anúbis", "Rá", "Buda", "Gandhi", "Einstein", "Newton",
    "Da Vinci", "Picasso", "Van Gogh", "Mozart", "Beethoven", "Shakespeare", "Colombo", "Cabral", "Dom Pedro I", "Dom Pedro II",
    "Tiradentes", "Zumbi dos Palmares", "Lampião", "Maria Bonita", "Getúlio Vargas", "Juscelino Kubitschek", "Lula", "Bolsonaro",
    "Obama", "Trump", "Rainha Elizabeth", "Princesa Diana", "Hitler", "Napoleão", "César", "Cleópatra", "Rei Arthur", "Robin Hood"
  ],
  "Esportes & Lazer": [
    "Futebol", "Vôlei", "Basquete", "Handebol", "Tênis", "Ping Pong", "Badminton", "Golfe", "Beisebol", "Futebol Americano", "Rugby",
    "Hóquei", "Críquete", "Polo Aquático", "Natação", "Surfe", "Skate", "Patinação", "Ciclismo", "Corrida", "Atletismo", "Salto em Distância",
    "Salto em Altura", "Ginástica", "Judô", "Karatê", "Jiu-Jitsu", "Taekwondo", "Boxe", "MMA", "Capoeira", "Luta Livre", "Esgrima",
    "Arco e Flecha", "Tiro ao Alvo", "Hipismo", "Fórmula 1", "Kart", "Motocross", "Rali", "Paraquedismo", "Asa Delta", "Bungee Jumping",
    "Escalada", "Trilha", "Acampamento", "Pesca", "Sinuca", "Boliche", "Dardo", "Xadrez", "Dama", "Dominó", "Baralho", "Poker", "Truco",
    "Uno", "Videogame", "Palavras Cruzadas", "Quebra-Cabeça", "Dança", "Balé", "Samba", "Forró", "Funk", "Rock", "Pop", "Sertanejo",
    "Pagode", "Música Clássica", "Violão", "Guitarra", "Baixo", "Bateria", "Teclado", "Piano", "Violino", "Saxofone", "Flauta", "Trompete",
    "Gaita", "Acordeon", "Pandeiro", "Tambor", "Microfone", "Bola", "Chuteira", "Raquete", "Rede", "Gol", "Cesta", "Piscina", "Tatame"
  ]
};

// Converte a estrutura RAW para o formato que o app usa
const FULL_DATABASE = Object.entries(RAW_DATA).flatMap(([category, items]) => 
  items.map(name => ({ name, category }))
);

// --- SOM ---
const playSound = (type, muted) => {
  if (muted) return;
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  if (!AudioContext) return;
  const ctx = new AudioContext();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);
  const now = ctx.currentTime;

  if (type === 'correct') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(523.25, now);
    osc.frequency.setValueAtTime(659.25, now + 0.1);
    gain.gain.setValueAtTime(0.3, now);
    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
    osc.start(now);
    osc.stop(now + 0.3);
  } else if (type === 'wrong') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(300, now);
    osc.frequency.linearRampToValueAtTime(100, now + 0.2);
    gain.gain.setValueAtTime(0.3, now);
    gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
    osc.start(now);
    osc.stop(now + 0.2);
  } else if (type === 'tick') {
    osc.type = 'square';
    osc.frequency.setValueAtTime(800, now);
    gain.gain.setValueAtTime(0.05, now);
    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
    osc.start(now);
    osc.stop(now + 0.05);
  } else if (type === 'end') {
    osc.type = 'sine';
    osc.frequency.setValueAtTime(800, now);
    osc.frequency.linearRampToValueAtTime(800, now + 0.5);
    gain.gain.setValueAtTime(0.5, now);
    gain.gain.linearRampToValueAtTime(0.01, now + 0.5);
    osc.start(now);
    osc.stop(now + 0.5);
  }
};

// --- UTILS ---
const shuffleArray = (array) => {
  const newArray = [...array];
  for (let i = newArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
  }
  return newArray;
};

export default function App() {
  const [globalScore, setGlobalScore] = useState(0);
  const [muted, setMuted] = useState(false);
  const [gameState, setGameState] = useState('setup');
  const [roundScore, setRoundScore] = useState(0);
  const [roundMistakes, setRoundMistakes] = useState(0);
  const [timeLeft, setTimeLeft] = useState(60);
  const [selectedTime, setSelectedTime] = useState(60);
  const [customTimeInput, setCustomTimeInput] = useState("");
  
  const [currentCard, setCurrentCard] = useState(null);
  
  const [flash, setFlash] = useState(null);
  const [selectedCategory, setSelectedCategory] = useState('Variados');
  const [isCategoryMenuOpen, setIsCategoryMenuOpen] = useState(false);
  
  const timerRef = useRef(null);
  const deckRef = useRef([]); 

  const uniqueCategories = useMemo(() => {
    return ['Variados', ...Object.keys(RAW_DATA).sort()];
  }, []);

  // --- LÓGICA DE BARALHO INTELIGENTE ---
  
  const generateDeck = useCallback((category) => {
    let rawDeck = FULL_DATABASE;
    if (category !== 'Variados') {
        rawDeck = FULL_DATABASE.filter(item => item.category === category);
    }
    return shuffleArray(rawDeck);
  }, []);

  const drawNextCard = useCallback(() => {
    if (deckRef.current.length === 0) {
        deckRef.current = generateDeck(selectedCategory);
        
        if (currentCard && deckRef.current.length > 1) {
            const nextCard = deckRef.current[deckRef.current.length - 1]; 
            if (nextCard.name === currentCard.name) {
                const lastIdx = deckRef.current.length - 1;
                [deckRef.current[lastIdx], deckRef.current[0]] = [deckRef.current[0], deckRef.current[lastIdx]];
            }
        }
    }
    
    const card = deckRef.current.pop();
    return { ...card, _uid: Math.random() };
  }, [selectedCategory, generateDeck, currentCard]);


  // --- FLUXO DO JOGO ---

  const enterFullscreen = () => {
    const elem = document.documentElement;
    if (!document.fullscreenElement && !document.webkitFullscreenElement) {
        if (elem.requestFullscreen) {
            elem.requestFullscreen().catch(err => console.log(err));
        } else if (elem.webkitRequestFullscreen) {
            elem.webkitRequestFullscreen();
        }
    }
  };

  const startGame = () => {
    let duration = selectedTime;
    if (selectedTime === 'custom') {
      const customMin = parseInt(customTimeInput);
      duration = (customMin && customMin > 0 ? customMin : 1) * 60;
    }

    deckRef.current = generateDeck(selectedCategory);

    setRoundScore(0);
    setRoundMistakes(0);
    setTimeLeft(duration);
    
    const card = deckRef.current.pop();
    setCurrentCard({ ...card, _uid: Math.random() });
    
    setGameState('playing');

    enterFullscreen();
    if ('wakeLock' in navigator) {
      navigator.wakeLock.request('screen').catch(e => console.log('Wake Lock denied', e));
    }
  };

  const finishGame = useCallback(() => {
    clearInterval(timerRef.current);
    playSound('end', muted);
    setGameState('finished');
  }, [muted]);

  const exitGame = () => {
    clearInterval(timerRef.current);
    setGameState('setup');
  };

  const resetAll = () => {
    setGlobalScore(0);
    setRoundScore(0);
    setRoundMistakes(0);
    setGameState('setup');
  };

  useEffect(() => {
    if (gameState === 'playing') {
      timerRef.current = setInterval(() => {
        setTimeLeft((prev) => {
          if (prev <= 1) {
            finishGame();
            return 0;
          }
          if (prev <= 10) playSound('tick', muted);
          return prev - 1;
        });
      }, 1000);
    }
    return () => clearInterval(timerRef.current);
  }, [gameState, finishGame, muted]);

  const handleAnswer = (type) => {
    if (gameState !== 'playing') return;

    setFlash(type === 'correct' ? 'green' : 'pink');
    setTimeout(() => setFlash(null), 200);

    playSound(type === 'correct' ? 'correct' : 'wrong', muted);

    if (type === 'correct') {
      setRoundScore(s => s + 1);
      setGlobalScore(g => g + 1);
    } else {
      setRoundMistakes(m => m + 1);
    }
    
    const next = drawNextCard();
    setCurrentCard(next);
  };

  const formatTime = (seconds) => {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return `${m}:${s < 10 ? '0' : ''}${s}`;
  };

  return (
    <div className="fixed inset-0 w-full h-full bg-[#FFF1F2] overflow-hidden font-quicksand select-none touch-none">
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Shrikhand&display=swap');
        .retro-font { font-family: 'Shrikhand', cursive; letter-spacing: 1px; }
        
        .responsive-container {
             width: 100%; height: 100%;
             display: flex; flex-direction: column;
             position: relative;
        }

        @media screen and (orientation: portrait) {
             .rotate-on-play {
                 position: absolute; top: 50%; left: 50%;
                 width: 100vh; height: 100vw;
                 transform: translate(-50%, -50%) rotate(90deg);
             }
        }
        
        @keyframes pop { 0% { transform: scale(0.9); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .animate-pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        @keyframes swing-q {
            0% { transform: rotate(-8deg); }
            50% { transform: rotate(8deg); }
            100% { transform: rotate(-8deg); }
        }
        @keyframes pulse-soft {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .animate-swing { animation: swing-q 3s ease-in-out infinite; transform-origin: center bottom; }
        .animate-pulse-soft { animation: pulse-soft 2s infinite; }
        
        .allow-interaction {
            pointer-events: auto !important;
            touch-action: manipulation !important;
            user-select: text !important;
            -webkit-user-select: text !important;
        }

        .custom-scrollbar::-webkit-scrollbar {
          width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f1f1;
          border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #2dd4bf;
          border-radius: 4px;
        }
      `}</style>

      {flash && (
        <div className={`fixed inset-0 z-50 pointer-events-none transition-opacity duration-200 ${flash === 'green' ? 'bg-green-500/40' : 'bg-[#FF7082]/40'}`} />
      )}

      <div className={gameState === 'playing' ? "rotate-on-play responsive-container" : "responsive-container"}>
        
        {/* CABEÇALHO DO JOGO */}
        {gameState === 'playing' && (
          <div className="flex-shrink-0 h-[15%] w-full flex justify-between items-center px-8 sm:px-12 pt-4">
             <div className="flex items-center gap-4">
                <button 
                   onClick={exitGame}
                   className="p-3 bg-red-100 rounded-full text-red-500 border-2 border-red-200 shadow-sm active:scale-95 transition-transform"
                   title="Sair do Jogo"
                >
                   <LogOut size={22} />
                </button>

                <div className="flex flex-col items-start">
                  <span className="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Total</span>
                  <div className="flex items-center gap-2 bg-yellow-100 px-4 py-1.5 rounded-full border-2 border-yellow-300 shadow-sm transition-transform duration-200" key={globalScore}>
                    <Trophy size={18} className="text-yellow-600" />
                    <span className="retro-font text-xl text-yellow-700 animate-pop">{globalScore}</span>
                  </div>
                </div>
             </div>

             <div className="flex flex-col items-end">
                <span className="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Tempo</span>
                <div className={`flex items-center gap-2 px-4 py-1.5 rounded-full border-2 shadow-sm font-bold text-xl font-mono ${timeLeft <= 10 ? 'bg-red-100 border-red-300 text-red-600 animate-pulse' : 'bg-white border-gray-200 text-gray-600'}`}>
                   {formatTime(timeLeft)}
                </div>
             </div>
          </div>
        )}

        {/* ÁREA PRINCIPAL */}
        <div className="flex-1 w-full flex items-center justify-center p-4 px-8 sm:px-16 relative">
           
           {/* === MENU === */}
           {gameState === 'setup' && (
             <div className="w-full max-w-md bg-white/70 backdrop-blur-md rounded-3xl border-4 border-[#FF9EAA] p-6 shadow-xl flex flex-col items-center gap-4 animate-pop relative z-10">
                <div className="text-center">
                   <h1 className="retro-font text-5xl text-[#FF7082] drop-shadow-[2px_2px_0px_#14B8A6] -rotate-2">
                     Cara a Cara
                   </h1>
                </div>

                <div className="w-full bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-inner flex flex-col gap-4 relative">
                   
                   {/* SELEÇÃO DE TEMPO */}
                   <div>
                     <p className="text-center text-xs font-bold text-gray-400 uppercase mb-2">Tempo da Partida</p>
                     <div className="grid grid-cols-4 gap-2">
                        {[60, 180, 300].map(sec => (
                          <button 
                            key={sec}
                            onClick={() => setSelectedTime(sec)}
                            className={`flex flex-col items-center justify-center py-2 rounded-xl border-2 transition-all ${selectedTime === sec ? 'border-teal-400 bg-teal-50 text-teal-600 shadow-md transform scale-105' : 'border-transparent bg-gray-50 text-gray-400'}`}
                          >
                            <span className="text-lg font-bold">{sec / 60}</span>
                            <span className="text-[9px] font-bold">MIN</span>
                          </button>
                        ))}
                        
                        <button 
                           onClick={() => setSelectedTime('custom')}
                           className={`flex flex-col items-center justify-center py-2 rounded-xl border-2 transition-all ${selectedTime === 'custom' ? 'border-teal-400 bg-teal-50 text-teal-600' : 'border-transparent bg-gray-50 text-gray-400'}`}
                        >
                           <Settings size={18} />
                           <span className="text-[9px] font-bold mt-1">??</span>
                        </button>
                     </div>

                     {selectedTime === 'custom' && (
                       <div className="mt-2 flex gap-2 items-center justify-center animate-pop">
                          <input 
                             type="number" 
                             inputMode="numeric"
                             pattern="[0-9]*"
                             placeholder="0" 
                             value={customTimeInput}
                             onChange={(e) => setCustomTimeInput(e.target.value)}
                             onPointerDown={(e) => e.stopPropagation()} 
                             style={{ fontSize: '24px' }}
                             className="allow-interaction w-24 p-2 text-center rounded-xl border-2 border-teal-200 font-bold text-teal-600 focus:outline-none focus:border-teal-500 bg-gray-50"
                          />
                          <span className="text-sm font-bold text-gray-400">minutos</span>
                       </div>
                     )}
                   </div>

                   {/* SELEÇÃO DE CATEGORIA - CUSTOMIZADO */}
                   <div className="relative">
                     <p className="text-center text-xs font-bold text-gray-400 uppercase mb-2">Categoria</p>
                     
                     <button 
                        onClick={() => setIsCategoryMenuOpen(!isCategoryMenuOpen)}
                        className="w-full p-3 rounded-xl border-2 border-teal-100 bg-teal-50 text-teal-700 flex items-center justify-between active:scale-[0.98] transition-all"
                     >
                        <span className="flex-1 text-center retro-font text-lg tracking-wide">{selectedCategory}</span>
                        {isCategoryMenuOpen ? <ChevronUp size={24} className="text-teal-500"/> : <ChevronDown size={24} className="text-teal-500"/>}
                     </button>

                     {/* DROPDOWN CUSTOMIZADO */}
                     {isCategoryMenuOpen && (
                        <div className="absolute top-full left-0 w-full mt-2 bg-white rounded-xl border-2 border-teal-200 shadow-xl max-h-[200px] overflow-y-auto custom-scrollbar z-50 animate-pop">
                           {uniqueCategories.map(cat => (
                              <button
                                 key={cat}
                                 onClick={() => {
                                    setSelectedCategory(cat);
                                    setIsCategoryMenuOpen(false);
                                 }}
                                 className={`w-full py-3 px-4 text-center font-bold text-sm border-b border-gray-50 last:border-0 hover:bg-teal-50 transition-colors ${selectedCategory === cat ? 'text-teal-600 bg-teal-50' : 'text-gray-600'}`}
                              >
                                 {cat}
                              </button>
                           ))}
                        </div>
                     )}
                     
                     {isCategoryMenuOpen && (
                        <div className="fixed inset-0 z-40" onClick={() => setIsCategoryMenuOpen(false)}></div>
                     )}
                   </div>

                </div>

                <div className="flex items-center gap-2 bg-yellow-50 px-5 py-2 rounded-full border border-yellow-200">
                    <span className="text-xs font-bold text-yellow-600 uppercase">Total Acumulado</span>
                    <span className="retro-font text-2xl text-yellow-700">{globalScore}</span>
                </div>

                <div className="flex gap-3 w-full mt-2">
                    <button onClick={() => setMuted(!muted)} className="p-4 bg-gray-100 rounded-2xl text-gray-500 hover:bg-gray-200 active:scale-95 transition-transform">
                       {muted ? <VolumeX /> : <Volume2 />}
                    </button>
                    <button 
                      onClick={startGame}
                      className="flex-1 bg-[#FF7082] hover:bg-[#ff5a6e] text-white text-xl font-bold py-4 rounded-2xl shadow-[0px_4px_0px_#be123c] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2"
                    >
                       <Play fill="currentColor" /> INICIAR
                    </button>
                </div>
                
                {globalScore > 0 && (
                  <button onClick={resetAll} className="text-xs text-red-300 font-bold flex items-center gap-1 hover:text-red-500 py-2">
                     <Trash2 size={12} /> Zerar placar
                  </button>
                )}
             </div>
           )}

           {/* === JOGO (PLAYING) === */}
           {gameState === 'playing' && (
             <div className="w-full h-full max-w-4xl flex flex-col items-center justify-center pb-2">
                
                <div className="flex-1 w-full relative mb-6 flex items-center justify-center">
                    <div 
                        key={currentCard?._uid}
                        className="bg-white w-full h-full max-h-[60vh] rounded-[2rem] border-[6px] border-[#FF9EAA] shadow-lg flex flex-col items-center justify-center p-6 text-center animate-pop relative overflow-hidden"
                    >
                        
                        <div className="absolute top-4 left-6 w-[12vmin] h-[12vmin] pointer-events-none opacity-90 z-10">
                            <svg viewBox="0 0 200 200" className="w-full h-full drop-shadow-sm">
                                <g className="animate-swing">
                                    <path d="M100,160 L100,120" stroke="#FF9EAA" strokeWidth="25" strokeLinecap="round" />
                                    <circle cx="100" cy="180" r="14" fill="#2DD4BF" stroke="#fff" strokeWidth="4" />
                                    <path d="M65,70 C65,20 135,20 135,70 C135,100 100,100 100,125" fill="none" stroke="#FF9EAA" strokeWidth="25" strokeLinecap="round" strokeLinejoin="round"/>
                                    <path d="M75,70 C75,35 125,35 125,70 C125,90 100,90 100,110" fill="none" stroke="#FF7082" strokeWidth="6" strokeLinecap="round" opacity="0.6"/>
                                </g>
                                <text x="140" y="50" fontSize="40" fill="#2DD4BF" className="animate-pulse-soft">✨</text>
                            </svg>
                        </div>

                        <div className="absolute top-6 right-6 bg-teal-100 text-teal-700 px-4 py-1.5 rounded-full text-xs font-extrabold uppercase tracking-wide z-10 shadow-sm">
                           {currentCard?.category}
                        </div>
                        
                        <h2 className="retro-font text-[#374151] leading-none break-words w-full mt-8"
                            style={{ fontSize: currentCard?.name.length > 15 ? '8vmin' : '13vmin' }}>
                           {currentCard?.name}
                        </h2>
                    </div>
                </div>

                {/* BOTÕES DE AÇÃO */}
                <div className="w-full h-[25%] flex gap-6 px-4">
                   <button 
                      onPointerDown={() => handleAnswer('wrong')}
                      className="flex-1 bg-[#FF7082] hover:bg-[#ff5a6e] active:bg-[#e11d48] rounded-[2rem] shadow-[0px_6px_0px_#be123c] active:translate-y-1 active:shadow-none transition-all flex flex-col items-center justify-center group"
                   >
                      <X size={48} className="text-white drop-shadow-md group-active:scale-90 transition-transform" />
                      <span className="text-white font-bold uppercase tracking-wider text-sm mt-1">Pular / Errei</span>
                   </button>

                   <button 
                      onPointerDown={() => handleAnswer('correct')}
                      className="flex-1 bg-green-500 hover:bg-green-600 active:bg-green-700 rounded-[2rem] shadow-[0px_6px_0px_#15803d] active:translate-y-1 active:shadow-none transition-all flex flex-col items-center justify-center group"
                   >
                      <Check size={48} className="text-white drop-shadow-md group-active:scale-90 transition-transform" />
                      <span className="text-white font-bold uppercase tracking-wider text-sm mt-1">Acertei!</span>
                   </button>
                </div>

             </div>
           )}

           {/* === FIM DE JOGO === */}
           {gameState === 'finished' && (
             <div className="w-full max-w-md bg-white rounded-3xl border-4 border-gray-200 p-6 shadow-2xl flex flex-col items-center animate-pop relative">
                
                <div className="absolute -top-5 bg-red-500 text-white px-6 py-2 rounded-full font-bold shadow-lg uppercase tracking-widest animate-pulse text-sm">
                   Tempo Esgotado!
                </div>

                <div className="mt-6 text-center w-full">
                   <h2 className="text-gray-400 font-bold text-sm uppercase mb-4">Resultado desta rodada</h2>
                   <div className="flex justify-center gap-6 mb-6">
                      <div className="flex flex-col items-center bg-green-50 p-4 rounded-2xl w-28">
                         <span className="text-4xl font-bold text-green-500">{roundScore}</span>
                         <span className="text-[10px] font-bold text-green-700 mt-1">ACERTOS</span>
                      </div>
                      <div className="flex flex-col items-center bg-red-50 p-4 rounded-2xl w-28">
                         <span className="text-4xl font-bold text-[#FF7082]">{roundMistakes}</span>
                         <span className="text-[10px] font-bold text-red-700 mt-1">ERROS</span>
                      </div>
                   </div>

                   <div className="bg-yellow-50 p-4 rounded-xl border border-yellow-200 mb-6">
                      <p className="text-yellow-700 text-xs font-bold uppercase">Total Acumulado</p>
                      <div className="flex items-center justify-center gap-2 mt-1">
                         <Trophy size={20} className="text-yellow-600" />
                         <span className="retro-font text-2xl text-yellow-800">{globalScore} pts</span>
                      </div>
                   </div>

                   <div className="grid grid-cols-2 gap-3 w-full">
                      <button onClick={resetAll} className="bg-gray-200 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-300 flex items-center justify-center gap-2 text-sm">
                         <RotateCcw size={16} /> Zerar Tudo
                      </button>
                      <button onClick={() => setGameState('setup')} className="bg-teal-500 text-white font-bold py-3 rounded-xl shadow-[0px_4px_0px_#0f766e] active:translate-y-1 active:shadow-none hover:bg-teal-400 flex items-center justify-center gap-2 text-sm">
                         <Play size={16} fill="currentColor" /> Jogar Mais
                      </button>
                   </div>
                </div>
             </div>
           )}

        </div>
      </div>
    </div>
  );
}


